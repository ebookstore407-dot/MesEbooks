      - name: Envoyer un email de notification
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          username: ebookstore407@gmail.com
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: "Nouvel eBook publiÃ© ! ðŸ“š"
          body: "Un nouvel eBook a Ã©tÃ© ajoutÃ© Ã  votre bibliothÃ¨que. Consultez le site : https://ebookstore407-dot.github.io/MesEbooks/"
          to: tondestinataire@gmail.com
          from: ebookstore407@gmail.com
      - name: Notify Slack
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_CHANNEL: '#general'
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          SLACK_MESSAGE: 'Un nouvel eBook a Ã©tÃ© publiÃ© ! ðŸŽ‰'
      - name: Installer pdf-thumbnail
        run: npm install pdf-thumbnail

      - name: GÃ©nÃ©rer les miniatures PDF
        run: node generate-thumbnails.js
name: DÃ©ploiement site statique

on:
  push:
    branches:
      - main   # DÃ©clenche le workflow Ã  chaque push sur main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: VÃ©rifier le code
        uses: actions/checkout@v3

      - name: Installer pdf-thumbnail
        run: npm install pdf-thumbnail

      - name: GÃ©nÃ©rer les miniatures PDF
        run: |
          const fs = require('fs');
          const path = require('path');
          const pdfThumbnail = require('pdf-thumbnail');

          const pdfDir = './ebooks/';
          const thumbDir = './images/thumbnails/';

          fs.readdirSync(pdfDir).forEach(file => {
            if (file.endsWith('.pdf')) {
              const pdfPath = path.join(pdfDir, file);
              const thumbPath = path.join(thumbDir, file.replace('.pdf', '.png'));
              pdfThumbnail(pdfPath).then(buffer => fs.writeFileSync(thumbPath, buffer));
            }
          });

      - name: Save state
        run: echo "myState=done" >> $GITHUB_STATE

      - name: Set output
        run: echo "myOutput=done" >> $GITHUB_OUTPUT
      - name: DÃ©ployer sur GitHub Pages
        uses: peaceiris/actions-gh-pages@v5
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./  # dossier Ã  publier, ici la racine
